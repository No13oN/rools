# Правила агентів (Канонічні)

## Роль
Агент працює у файловій архітектурі з жорсткими правилами безпеки, маршрутизації та запису.

## Обов'язкова поведінка
1. Спочатку читати активний контекст.
2. Завантажувати лише мінімально потрібні файли.
3. Писати лише у дозволені цілі.
4. Ніколи не розкривати секрети.

## Порядок читання
1. Активний mission/context файл.
2. Індекс бази знань.
3. Потрібний протокол або шаблон.
4. Релевантні останні логи.

## Правила запису
- Заборонено:
  - конкурентний запис у спільний mutable-файл;
  - прямі неконтрольовані зміни у `10_KNOWLEDGE`;
  - перезапис логів.
- Обов'язково:
  - міжагентний обмін лише через inbox-файли;
  - логи тільки append-only;
  - фіксація власника й часу в метаданих.

## Контракт повідомлень
- Призначення: `00_EXCHANGE/inbox_{recipient}/`
- Ім'я файлу: `msg_{YYYYMMDD_HHMMSS}_{sender}_{topic}.md`
- Шаблон:
```md
---
type: message
from: {sender}
to: {recipient}
priority: normal
timestamp: {ISO-8601}
---

## Context
...

## Request
...

## Expected Action
...
```

## Контракт оновлення знань
1. Створити proposal-повідомлення відповідальному.
2. Дочекатися погодження.
3. Внести контрольовану зміну.
4. Якщо зміна архітектурна — зафіксувати ADR.

## Контракт логування
- `sessions`: лише додавання дій.
- `errors`: лише додавання помилок із timestamp.
- `decisions`: ADR для структурних/незворотних рішень.

## Безпека секретів
- API-ключі/токени не зберігаються в Markdown.
- Підозрілі значення негайно редагуються на `[REDACTED]`.
- Інцидент фіксується без розкриття сирого значення.

## Обробка конфліктів
Якщо файл зайнятий або заблокований:
1. не форсувати запис;
2. надіслати inbox-повідомлення власнику/супервізору;
3. продовжити незалежні підзадачі.

## Open Issues (V1 vs V2)
1. `scratchpad.md` як канал між агентами (V1) суперечить inbox-моделі (V2):
Рішення: scratchpad не використовується для міжагентної комунікації.

2. Пряме логування в довільні файли (V1-практика) vs стандартизовані `sessions/errors/decisions`:
Рішення: логування лише у стандартизовані цілі.

3. Різні формати імен файлів повідомлень:
Рішення: канонічний шаблон імені з timestamp + sender + topic.

## Критерії завершення задачі
1. Результат записано у правильну ціль.
2. Логи доповнено.
3. Заборонених записів не було.
4. За потреби наступна дія маршрутизована через inbox.
