# Міграційний Runbook (Канонічний)

## Мета
Покроково перевести документи і робочі правила до канонічної моделі без втрати керованості.

## Режими
- `Сценарій A`: діюче середовище.
- `Сценарій B`: нове середовище.

## Загальні правила
1. До завершення валідації нічого не видаляти без резервної копії.
2. На кожен тип документа має бути лише один канонічний файл.
3. Спочатку конвертація в Markdown, потім злиття.
4. Ключові рішення фіксувати в ADR.

## Сценарій A: діюче середовище

### Фаза 0: Безпека
1. Зробити повний backup.
2. На час міграції заморозити несуттєві зміни.
3. Призначити одного відповідального за міграцію.

### Фаза 1: Інвентаризація
1. Зібрати перелік файлів і хеші.
2. Позначити точні дублікати й near-duplicates.
3. Розкласифікувати: архітектура, правила, міграція, скрипти, legacy.

### Фаза 2: Конвертація
1. Конвертувати `.docx` у UTF-8 `.md`.
2. Нормалізувати заголовки, таблиці, code blocks.
3. Прибрати артефакти форматування.

### Фаза 3: Канонічне злиття
1. Зібрати `ARCHITECTURE.md` з плану + критики.
2. Зібрати `MIGRATION_RUNBOOK.md` з чеклістів і планів міграції.
3. Зібрати `AGENT_RULES.md` з rule/addendum-фрагментів.
4. Додати секцію `Open Issues` для конфліктів між V1/V2.

### Фаза 4: Вирівнювання структури
1. Упевнитися, що існують канонічні директорії (`00/10/20/99/90`).
2. Перевести міжагентну комунікацію на inbox-модель.
3. Перенести legacy-матеріали в `90_ARCHIVE`.

### Фаза 5: Валідація
1. Агент знаходить контекст і потрібні протоколи.
2. Немає спільних файлів для конкурентного запису.
3. Історія змін піддається аудиту.
4. Retrieval проходить через індекс без повного сканування всіх файлів.

### Фаза 6: Фіксація
1. Позначити канонічні документи як активні.
2. Позначити дублікати як deprecated.
3. Прибрати deprecated-файли з активного контуру після контрольного періоду.

## Сценарій B: нове середовище

### Фаза 0: Bootstrap
1. Створити канонічну структуру директорій.
2. Створити 3 базові документи: `ARCHITECTURE.md`, `MIGRATION_RUNBOOK.md`, `AGENT_RULES.md`.
3. Додати шаблони для context/decision/message.

### Фаза 1: Governance
1. Правило один документ на тип.
2. Уніфіковане іменування (snake_case або kebab-case).
3. YAML frontmatter в операційних файлах.

### Фаза 2: Operational Hardening
1. Лише inbox для міжагентного обміну.
2. Логи append-only.
3. Оновлення knowledge через proposal/review.

### Фаза 3: Quality Gate
1. Валідація retrieval-шляхів.
2. Валідація conflict-free write.
3. Валідація rollback-процедури.

## Open Issues (V1 vs V2)
1. Чи зберігати `00_CONTEXT/scratchpad.md` для тимчасових нотаток:
Рішення: допускається лише як локальний чернетковий файл одного власника, не для міжагентного обміну.

2. Чи переводити всі логи на `JSONL`:
Рішення: обов’язково append-only; формат `JSONL` вводиться поступово там, де потрібен машинний парсинг.

3. Чи робити auto-commit на кожну зміну knowledge:
Рішення: мінімум — commit по завершенню логічного кроку; авто-коміт як опція після стабілізації.

## Rollback
1. Зупинити міграційні зміни.
2. Відновити стан із backup.
3. Повторно застосувати лише перевірені канонічні документи.
4. Повторити фазу валідації.

## Критерії завершення
1. Канонічні документи існують і використовуються.
2. Дублікати виведені з активного контуру.
3. Критичні конфлікти V1/V2 закриті або явно зафіксовані.
4. Обидва сценарії мають виконуваний порядок дій.
